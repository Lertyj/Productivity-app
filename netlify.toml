# Этот файл должен быть в корневом каталоге вашего репозитория.

[build]
  # Директория, где находится ваше React-приложение (клиент)
  base = "./"
  # Путь для публикации (относительно 'base')
  publish = "client/build"
  
  # Оставляем только команду для сборки клиента, удаляя сложную команду для сервера.
  command = "cd client && npm install && npm run build && cd ../server && npm install && cd ../ "
  
  # !!! ИСПРАВЛЕНИЕ ДЛЯ ФУНКЦИЙ !!! 
  # Указываем путь к папке с функциями.
  functions = "server/netlify/functions" 

# ---
# Новая секция для управления бессерверными функциями Netlify
# ---
[functions]
  # Netlify ищет файл package.json в папке функций, но поскольку 
  # он находится в server/package.json, мы используем эту директиву,
  # чтобы указать, что Express и serverless-http должны быть в сборке.
  external_node_modules = [
    "express",
    "serverless-http"
  ]
  # Также убеждаемся, что Netlify использует Node.js для сборки функций:
  node_bundler = "esbuild"
  directory = "server/netlify/functions"

[[redirects]]
  from = "/api/*"
  

  to = "/.netlify/functions/api/:splat"
  
  status = 200
  force = true
